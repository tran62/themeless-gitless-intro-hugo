YUI.add("flickr-photos-getFavorites-fetcher",function(e,o){"use strict";e.namespace("ListFetchers")["flickr-photos-getFavorites"]={run:function(p,r){var t,s=this;return r.flipper.isFlipped("enable-scrappy-photo-page")&&(p.scrappy=!0),t=this._processParams(p),e.Promise.all([r.callAPI("flickr.photos.getFavorites",t,!0),r.getModelRegistry("photo-people-who-faved-models"),r.getModelRegistry("person-models")]).then(function(e){return s._processResponse(e,p,t)},e.FetcherErrorLogger(o))},_processParams:function(o){var p;return p={photo_id:o.id,extras:e.APIHelper.request.getRebootPhotoExtras(),per_page:o.perPage||50,page:o.page||1,hermes:1},o.scrappy&&(p.sort="date_asc"),p},_processResponse:function(o,p,r){var t,s=o[0],a=o[1],n=o[2];return t={id:s.photo.id,total:s.photo.total,people:[]},s.photo.person&&s.photo.person.forEach(function(o){var p=e.APIHelper.response.parsePerson(o);t.people.push(n.addOrUpdate(p))}),t.people={perPage:r.per_page,page:r.page,pageContent:t.people,totalItems:parseInt(t.total||0,10)},a.addOrUpdate(t),t.people.pageContent}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-people-who-faved-models","person-models"]});YUI.add("photo-people-who-faved-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-photos-getFavorites"].run(t,this.appContext)}},attributes:{total:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return(t=e.AttributeHelpers.coerceInteger(t))<0&&(t=0),t},defaultValue:0},people:{isCollection:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-photos-getFavorites"]}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-photos-getFavorites-fetcher"]});YUI.add("sub-photo-fave-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.photoId=e.photoId,""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this.faveCountSelector=this.appContext.flipper.isFlipped("enable-likes")?"a.person-count-link":"a.remaining-faved-by",this.displayedUserNsids=[],this},loadState:function(){var t=this,s=this.appContext.getViewer(),i=[];return i.push(this.appContext.getModel("photo-models",this.photoId).then(function(e){t.set("photo",e)})),i.push(this.appContext.getModel("photo-engagement-models",this.photoId).then(function(e){t.set("photo-engagement",e)})),i.push(this.appContext.getModel("photo-people-who-faved-models",this.photoId).then(function(e){t.set("photo-people-who-faved-model",e)})),s.signedIn&&t.appContext.getModel("person-models",s.nsid).then(function(e){t.set("viewer-person-model",e)}),e.Promise.all(i)},buildContainer:function(){var e,t=this.get("photo-people-who-faved-model"),s=t.getValue("total"),i=this.get("container"),n=this.get("photo"),o="";if(this.displayedUserNsids=[],0===s)this.setContainerHTML(""),i.removeClass("faves-present");else{(e=t.getValue("people").toJSON()).forEach(function(e){e.pathAlias+="/favorites"});var a=n.getSizeToFit({width:48,height:48},{sizes:n.getValue("sizes"),cropToFit:!0,includeSquare:!0});this.appContext.flipper.isFlipped("enable-likes")?o=this.constructFavedByLine():this.displayedUserNsids=e.slice(0,2).map(function(e){return e.nsid}),this.setContainerWithTemplate("sub-photo-faved-by",{people:e,totalPeopleFaved:s,remainingFavedBy:s-2,favedByLine:o,displayUrl:a?a.displayUrl:"",thumbUrl:e.length>0?"/photos/"+e[0].pathAlias:""}),i.addClass("faves-present"),this.get("photo").getValue("owner").getValue("isMe")||i.addClass("can-fave"),this.get("photo-engagement").getValue("isFaved")?i.addClass("is-faved"):i.removeClass("is-faved"),YUI.Env.isServer||i.show()}return this},constructFavedByLine:function(){var t=this.get("photo-people-who-faved-model"),s=t.getValue("total"),i=this.get("photo-engagement").getValue("isFaved"),n=this.get("viewer-person-model"),o=e.URLHelper.generatePersonUrls(n).favorites,a=t.getValue("people").getList().map(function(t){return{nsid:t.getValue("nsid"),name:t.getValue("displayname"),url:e.URLHelper.generatePersonUrls(t).favorites}}),l="";return i?1===s?(l=this.intlMessage({intlName:"likes.YOU_FAVED_THIS",youUrl:o}),this.displayedUserNsids.push(n.getValue("nsid"))):2===s?(l=this.intlMessage({intlName:"likes.YOU_AND_1_PERSON_FAVED_THIS",youUrl:o,person2Name:a[1].name,person2Url:a[1].url}),this.displayedUserNsids.push(n.getValue("nsid")),this.displayedUserNsids.push(a[1].nsid)):(l=this.intlMessage({intlName:"likes.YOU_AND_X_PEOPLE_FAVED_THIS",youUrl:o,personCountUrl:"#",personCountString:e.IntlNumber.format(s-1,this.appContext.lang,1)}),this.displayedUserNsids.push(n.getValue("nsid"))):1===s?(l=this.intlMessage({intlName:"likes.1_PERSON_FAVED_THIS",personName:a[0].name,personUrl:a[0].url}),this.displayedUserNsids.push(a[0].nsid)):2===s?(l=this.intlMessage({intlName:"likes.2_PEOPLE_FAVED_THIS",personName:a[0].name,personUrl:a[0].url,person2Name:a[1].name,person2Url:a[1].url}),this.displayedUserNsids.push(a[0].nsid),this.displayedUserNsids.push(a[1].nsid)):3===s?(l=this.intlMessage({intlName:"likes.3_PEOPLE_FAVED_THIS",personName:a[0].name,personUrl:a[0].url,person2Name:a[1].name,person2Url:a[1].url,person3Name:a[2].name,person3Url:a[2].url}),this.displayedUserNsids.push(a[0].nsid),this.displayedUserNsids.push(a[1].nsid),this.displayedUserNsids.push(a[2].nsid)):(l=this.intlMessage({intlName:"likes.X_PEOPLE_FAVED_THIS",personName:a[0].name,personUrl:a[0].url,person2Name:a[1].name,person2Url:a[1].url,personCountUrl:"#",personCountString:e.IntlNumber.format(s-2,this.appContext.lang,1)}),this.displayedUserNsids.push(a[0].nsid),this.displayedUserNsids.push(a[1].nsid)),l},activate:function(){var t=this,s=this.get("container");return this.appContext.flipper.isFlipped("enable-likes")?this.registerEventHandler(s.delegate("click",this.faveCountClicked,this.faveCountSelector,t)):(this.registerEventHandler(s.delegate("click",this.faveCountClicked,this.faveCountSelector,t)),s.hasClass("can-fave")&&s.all("svg.icon, i.animated-fave-star").size()&&this.registerEventHandler(s.delegate("click",this.handleFaveClick,"svg.icon, i.animated-fave-star",this))),s.one(".faved-by")||s.setStyle("display","none"),this.get("photo-engagement")&&this.registerEventHandler(this.get("photo-engagement").on("valuesChanged",function(s){void 0!==s.faveCount&&(t.get("photo-engagement").getValue("isFaved")?t.get("photo-engagement").getValue("faveCount")<=t.get("photo-people-who-faved-model").getValue("people").getList().length+1&&t.get("photo-people-who-faved-model").getValue("people").appendToList(t.get("viewer-person-model")):t.get("photo-people-who-faved-model").getValue("people").removeFromList(t.appContext.getViewer().nsid),t.get("photo-people-who-faved-model").setValue("total",t.get("photo-engagement").getValue("faveCount")),t.get("photo-engagement").remoteUpdate().then(function(){t.processingFave=!1,t.buildContainer()},function(s){if(t.processingFave=!1,3!==s.code){t.get("photo-people-who-faved-model").revertValue("people"),t.get("photo-people-who-faved-model").revertValue("total"),t.get("photo-engagement").registry.toggleFave(t.photoId),t.buildContainer();new e.Views.FluidModal({title:t.intlMessage({intlName:"common.ERROR"}),actionButtonLabel:t.intlMessage({intlName:"common.OK"}),htmlMessage:t.intlMessage({intlName:"fave-view.COULDNT_FAVE"}),appContext:t.appContext,classList:"scrappy-dialog",dismissOnOverlayClick:!1,dismissOnActionClick:!0,actionButtonDisabled:!1,showCancelButton:!0,hideModalOverlay:!1,showCancelX:!0}).show()}}))})),this},faveCountClicked:function(t,s){t.preventDefault();var i,n=this.get("container").one(this.faveCountSelector),o=new e.Views["photo-faved-by-list-view"]({appContext:this.appContext,photoId:this.photoId,excludedNsids:this.displayedUserNsids});(i=new e.Views.FluidDroparound({appContext:this.appContext,showDropArrow:!0,observePageResize:!0,anchorOffsetVertical:0,width:220,dismissOnOverlayClick:!0,anchorElement:n,subview:o,autoSizeToContent:!0,contentPadding:0})).show(),o.on("loaded",function(){i.anchorPositionChange()})},handleFaveClick:function(t){var s=this;t.preventDefault(),this.processingFave||(this.appContext.getViewer().signedIn?(this.processingFave=!0,this.get("photo-engagement").registry.toggleFave(this.photoId),this.get("photo-engagement").getValue("isFaved")?(this.get("container").addClass("is-animating"),setTimeout(function(){s.get("container").removeClass("is-animating"),s.buildContainer()},333)):this.buildContainer(),e.rapidTracker.beacon(this.name,"faveStarFaveListClick")):this.signedOutFaveAttemptDialog())},signedOutFaveAttemptDialog:function(){var t,s=this;(t=new e.Views.FluidModal({appContext:this.appContext,title:this.intlMessage({intlName:"fave-view.SIGN_IN_BEFORE_FAVE_TITLE"}),htmlMessage:this.intlMessage({intlName:"fave-view.SIGN_IN_BEFORE_FAVE_MESSAGE"}),actionButtonLabel:this.intlMessage({intlName:"fave-view.SIGN_IN_AND_FAVE"}),cancelButtonLabel:this.intlMessage({intlName:"common.CANCEL"})})).on("actionClick",function(){e.SigninHelper.addPendingFave({id:s.photoId})}),t.show()}})},"@VERSION@",{requires:["flickr-view","photo-faved-by-list-view","hermes-template-sub-photo-faved-by","signin-helper","hermes-template-fave-menu","hermes-template-person","animation-manager","intl-number","url-helper"],optional:["photo-engagement-models","photo-people-who-faved-models","person-models"],langBundles:["common","photo-page-scrappy","fave-view","likes"]});YUI.add("hermes-lang-likes",function(e,s){e.Intl.add("hermes/likes","en-US",{LIKES_COUNT:[{type:"plural",valueName:"count",options:{one:["${countString}"," like"],other:["${countString}"," likes"]}}],LIKES_LABEL:[{type:"plural",valueName:"count",options:{one:"like",other:"likes"}}],"1_PERSON_LIKED_THIS":['<a class="person-link" href="',"${personUrl}",'">',"${personName}","</a> liked this"],YOU_LIKED_THIS:['<a class="you-link" href="',"${youUrl}",'">YOU</a> liked this'],"2_PEOPLE_LIKED_THIS":['<a class="person-link" href="',"${personUrl}",'">',"${personName}",'</a> and <a class="person-2-link" href="',"${person2Url}",'">',"${person2Name}","</a> liked this"],YOU_AND_1_PERSON_LIKED_THIS:['<a class="you-link" href="',"${youUrl}",'">YOU</a> and <a class="person-2-link" href="',"${person2Url}",'">',"${person2Name}","</a> liked this"],X_PEOPLE_LIKED_THIS:['<a class="person-link" href="',"${personUrl}",'">',"${personName}",'</a>, <a class="person-2-link" href="',"${person2Url}",'">',"${person2Name}",'</a> and <a class="person-count-link" href="',"${personCountUrl}",'">',"${personCountString}"," more people</a> liked this"],YOU_AND_X_PEOPLE_LIKED_THIS:['<a class="you-link" href="',"${youUrl}",'">YOU</a> and <a class="person-count-link" href="',"${personCountUrl}",'">',"${personCountString}"," more people</a> liked this"],"1_PERSON_FAVED_THIS":['<a class="person-link" href="',"${personUrl}",'">',"${personName}","</a> added this to Favorites"],YOU_FAVED_THIS:['<a class="you-link" href="',"${youUrl}",'">YOU</a> added this to Favorites'],"2_PEOPLE_FAVED_THIS":['<a class="person-link" href="',"${personUrl}",'">',"${personName}",'</a> and <a class="person-2-link" href="',"${person2Url}",'">',"${person2Name}","</a> added this to Favorites"],"3_PEOPLE_FAVED_THIS":['<a class="person-link" href="',"${personUrl}",'">',"${personName}",'</a>, <a class="person-2-link" href="',"${person2Url}",'">',"${person2Name}",'</a>, and <a class="person-2-link" href="',"${person3Url}",'">',"${person3Name}","</a> added this to Favorites"],YOU_AND_1_PERSON_FAVED_THIS:['<a class="you-link" href="',"${youUrl}",'">YOU</a> and <a class="person-2-link" href="',"${person2Url}",'">',"${person2Name}","</a> added this to Favorites"],X_PEOPLE_FAVED_THIS:['<a class="person-link" href="',"${personUrl}",'">',"${personName}",'</a>, <a class="person-2-link" href="',"${person2Url}",'">',"${person2Name}",'</a> and <a class="person-count-link" href="',"${personCountUrl}",'">',"${personCountString}"," more people</a> added this to Favorites"],YOU_AND_X_PEOPLE_FAVED_THIS:['<a class="you-link" href="',"${youUrl}",'">YOU</a> and <a class="person-count-link" href="',"${personCountUrl}",'">',"${personCountString}"," more people</a> added this to Favorites"],SIGN_IN_BEFORE_LIKE_TITLE:["You found a photo you like!"],JOIN_FLICKR_AND_LIKE:["Join Flickr to like this photo."]})},"@VERSION@",{requires:["intl"]});YUI.add("sub-photo-left-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{initializer:function(e){return this.nsid=e.nsid,this.photoId=e.photoId,this.backToURL=e.backToURL,""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),e.photoCommentsViewConfig={photoId:this.photoId,showPermalinks:!0,firstPerPage:20},this},subviewConfig:{"sub-photo-title-desc-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"attribution-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0,additionalViewClasses:["clear-float","photo-attribution"]},"sub-photo-comments-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,includePermalink:!0,disabled:function(){return this.appContext.flipper.isFlipped("enable-photo-page-comments-component")}},"photo-comments-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,includePermalink:!0,disabled:function(){return!this.appContext.flipper.isFlipped("enable-photo-page-comments-component")}},"sub-photo-fave-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,disabled:function(){return this.appContext.flipper.isFlipped("enable-likes")}},"sub-photo-liked-by-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,disabled:function(){return!this.appContext.flipper.isFlipped("enable-likes")}}},loadState:function(){return e.Promise.resolve()},buildContainer:function(){return this.setContainerWithTemplate("sub-photo-left"),this},buildErrorContainer:function(){},activate:function(){return this}})},"@VERSION@",{requires:["flickr-view","hermes-template-sub-photo-left","url-helper"],optional:["attribution-view","sub-photo-title-desc-view","photo-license-view","sub-photo-comments-view","sub-photo-fave-view"]});YUI.add("hermes-template-sub-photo-right",function(t,l){var e=t.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(t,l,e,n,o){var a=null!=l?l:t.nullContext||{},u=t.hooks.helperMissing,i=t.escapeExpression,s=t.lookupProperty||function(t,l){if(Object.prototype.hasOwnProperty.call(t,l))return t[l]};return'<div class="sub-photo-right-row1" tabindex="0">\n\t'+i((s(e,"outlet")||l&&s(l,"outlet")||u).call(a,null!=l?s(l,"sub-photo-right-stats-view"):l,{name:"outlet",hash:{},data:o,loc:{start:{line:2,column:1},end:{line:2,column:38}}}))+'\n\t<div class="date-license-container">\n\t\t'+i((s(e,"outlet")||l&&s(l,"outlet")||u).call(a,null!=l?s(l,"sub-photo-date-view"):l,{name:"outlet",hash:{},data:o,loc:{start:{line:4,column:2},end:{line:4,column:32}}}))+"\n\t\t"+i((s(e,"outlet")||l&&s(l,"outlet")||u).call(a,null!=l?s(l,"photo-license-view"):l,{name:"outlet",hash:{},data:o,loc:{start:{line:5,column:2},end:{line:5,column:31}}}))+"\n\t</div>\n</div>\n\n"+i((s(e,"outlet")||l&&s(l,"outlet")||u).call(a,null!=l?s(l,"photo-charm-exif-scrappy-view"):l,{name:"outlet",hash:{},data:o,loc:{start:{line:9,column:0},end:{line:9,column:40}}}))+"\n"+i((s(e,"outlet")||l&&s(l,"outlet")||u).call(a,null!=l?s(l,"sub-photo-submoola-view"):l,{name:"outlet",hash:{},data:o,loc:{start:{line:10,column:0},end:{line:10,column:34}}}))+"\n"+i((s(e,"outlet")||l&&s(l,"outlet")||u).call(a,null!=l?s(l,"sub-photo-contexts-view"):l,{name:"outlet",hash:{},data:o,loc:{start:{line:11,column:0},end:{line:11,column:34}}}))+"\n"+i((s(e,"outlet")||l&&s(l,"outlet")||u).call(a,null!=l?s(l,"sub-photo-tags-view"):l,{name:"outlet",hash:{},data:o,loc:{start:{line:12,column:0},end:{line:12,column:30}}}))+"\n"+i((s(e,"outlet")||l&&s(l,"outlet")||u).call(a,null!=l?s(l,"sub-photo-additional-info-view"):l,{name:"outlet",hash:{},data:o,loc:{start:{line:13,column:0},end:{line:13,column:41}}}))+"\n"},useData:!0}),n={};t.Array.each([],function(l){var e=t.Template.get("hermes/"+l);e&&(n[l]=e)}),t.Template.register("hermes/sub-photo-right",function(l,o){return o=o||{},o.partials=o.partials?t.merge(n,o.partials):n,e(l,o)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-sub-photo-submoola",function(e,a){var t=e.Template.Handlebars.revive({1:function(e,a,t,o,r){var n,l=e.lookupProperty||function(e,a){if(Object.prototype.hasOwnProperty.call(e,a))return e[a]};return'<div class="photo-page-m-container">\n'+(null!=(n=e.invokePartial(l(o,"prbd-moola-position"),a,{name:"prbd-moola-position",hash:{audienceTargets:null!=a?l(a,"audienceTargets"):a,upsellFallback:!1,adUnit:null!=a?l(a,"adUnit"):a},data:r,indent:"\t",helpers:t,partials:o,decorators:e.decorators}))?n:"")+"</div>\n"},compiler:[8,">= 4.3.0"],main:function(e,a,t,o,r){var n,l=e.lookupProperty||function(e,a){if(Object.prototype.hasOwnProperty.call(e,a))return e[a]};return null!=(n=l(t,"if").call(null!=a?a:e.nullContext||{},null!=a?l(a,"showPhotoPageAd"):a,{name:"if",hash:{},fn:e.program(1,r,0),inverse:e.noop,data:r,loc:{start:{line:1,column:0},end:{line:5,column:7}}}))?n:""},usePartial:!0,useData:!0}),o={};e.Array.each(["prbd-moola-position"],function(a){var t=e.Template.get("hermes/"+a);t&&(o[a]=t)}),e.Template.register("hermes/sub-photo-submoola",function(a,r){return r=r||{},r.partials=r.partials?e.merge(o,r.partials):o,t(a,r)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-prbd-moola-position"]});YUI.add("sub-photo-submoola-view",function(t){t.FlickrView.create(this.name,t.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(o){return this.nsid=o.nsid,this.photoId=o.photoId,this.isOwner=o.isOwner,this.showPhotoPageAd=!0,this.ad=t.config.flickr.moola.positions.photopage[0],this.adSlots=[],""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this},loadState:function(){var t=this;return this.appContext.getModel("photo-models",t.photoId).then(function(o){t.set("photo",o),this.appContext.adManager.canShowAd(t.get("photo"))||(this.showPhotoPageAd=!1)}.bind(this))},buildContainer:function(){var o=this.appContext.viewportData.getWidth(),i=t.config.flickr.moola.ad_breakpoint_mobile_desktop,e={showPhotoPageAd:this.showPhotoPageAd,adUnit:this.ad[o<i?"ad_unit_mobile":"ad_unit_desktop"],audienceTargets:this.appContext.audienceTargets.getAudienceData()};return this.adUnit=e.adUnit,this.setContainerWithTemplate("sub-photo-submoola",e),this},activate:function(){return this.showPhotoPageAd?(asc.cmd.push(asc.processAdsOnPage),this.appContext.adManager.signalAdRequest({adUnit:this.adUnit,photoId:this.photoId})):this.appContext.adManager.signalNonAdRequest({photoId:this.photoId}),this}})},"@VERSION@",{requires:["flickr-view","hermes-template-sub-photo-submoola","url-helper"],langBundles:["common"]});