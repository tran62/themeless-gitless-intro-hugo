YUI.add("hermes-template-notification-flickrmail",function(e,n){var l=e.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(e,n,l,a,t){var i,r=e.lambda,o=e.escapeExpression,s=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return'<a class="avatar person tiny no-menu" style="background-image: url('+o(r(null!=(i=null!=(i=null!=(i=null!=n?s(n,"event"):n)?s(i,"owner"):i)?s(i,"buddyicon"):i)?s(i,"small"):i,n))+');" href="'+o(r(null!=(i=null!=(i=null!=n?s(n,"event"):n)?s(i,"owner"):i)?s(i,"profileURL"):i,n))+'"></a>\n\n<div class="details">\n\t<span class="headline">\n\t\t'+o((s(l,"intlHTMLMessage")||n&&s(n,"intlHTMLMessage")||e.hooks.helperMissing).call(null!=n?n:e.nullContext||{},{name:"intlHTMLMessage",hash:{mailUrl:null!=(i=null!=(i=null!=n?s(n,"event"):n)?s(i,"mail"):i)?s(i,"url"):i,mailTitle:null!=(i=null!=(i=null!=n?s(n,"event"):n)?s(i,"mail"):i)?s(i,"title"):i,personUrl:null!=(i=null!=(i=null!=n?s(n,"event"):n)?s(i,"owner"):i)?s(i,"profileURL"):i,personName:null!=(i=null!=(i=null!=n?s(n,"event"):n)?s(i,"owner"):i)?s(i,"displayname"):i,intlName:"notifications.NOTIF_FLICKRMAIL"},data:t,loc:{start:{line:5,column:2},end:{line:5,column:183}}}))+"\n\t</span>\n\n"+(null!=(i=e.invokePartial(s(a,"notification-photo-extra-info"),n,{name:"notification-photo-extra-info",data:t,indent:"\t",helpers:l,partials:a,decorators:e.decorators}))?i:"")+"</div>"},usePartial:!0,useData:!0}),a={};e.Array.each(["notification-photo-extra-info"],function(n){var l=e.Template.get("hermes/"+n);l&&(a[n]=l)}),e.Template.register("hermes/notification-flickrmail",function(n,t){return t=t||{},t.partials=t.partials?e.merge(a,t.partials):a,l(n,t)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-notification-photo-extra-info"]});YUI.add("hermes-template-notification-testimonial",function(e,n){var l=e.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(e,n,l,t,a){var i,o=e.lambda,r=e.escapeExpression,s=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return'<a class="avatar person tiny no-menu" style="background-image: url('+r(o(null!=(i=null!=(i=null!=(i=null!=n?s(n,"event"):n)?s(i,"owner"):i)?s(i,"buddyicon"):i)?s(i,"small"):i,n))+');" href="'+r(o(null!=(i=null!=(i=null!=n?s(n,"event"):n)?s(i,"owner"):i)?s(i,"profileURL"):i,n))+'"></a>\n\n<div class="details">\n\t<span class="headline">\n\t\t'+r((s(l,"intlHTMLMessage")||n&&s(n,"intlHTMLMessage")||e.hooks.helperMissing).call(null!=n?n:e.nullContext||{},{name:"intlHTMLMessage",hash:{testimonialUrl:null!=(i=null!=n?s(n,"event"):n)?s(i,"url"):i,personUrl:null!=(i=null!=(i=null!=n?s(n,"event"):n)?s(i,"owner"):i)?s(i,"profileURL"):i,personName:null!=(i=null!=(i=null!=n?s(n,"event"):n)?s(i,"owner"):i)?s(i,"displayname"):i,intlName:"notifications.NOTIF_TESTIMONIAL"},data:a,loc:{start:{line:5,column:2},end:{line:5,column:159}}}))+"\n\t</span>\n\n"+(null!=(i=e.invokePartial(s(t,"notification-photo-extra-info"),n,{name:"notification-photo-extra-info",data:a,indent:"\t",helpers:l,partials:t,decorators:e.decorators}))?i:"")+"</div>\n"},usePartial:!0,useData:!0}),t={};e.Array.each(["notification-photo-extra-info"],function(n){var l=e.Template.get("hermes/"+n);l&&(t[n]=l)}),e.Template.register("hermes/notification-testimonial",function(n,a){return a=a||{},a.partials=a.partials?e.merge(t,a.partials):t,l(n,a)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-notification-photo-extra-info"]});YUI.add("hermes-template-notification-context-menu",function(t,n){var e=t.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(t,n,e,i,a){var o=null!=n?n:t.nullContext||{},l=t.hooks.helperMissing,s=t.escapeExpression,c=t.lookupProperty||function(t,n){if(Object.prototype.hasOwnProperty.call(t,n))return t[n]};return'<div class="notification-context-menu">\n\t\n\t<ul class="notification-context-list">\n\t\t<li class="notification-context-option turn-off-object-option">'+s((c(e,"intlMessage")||n&&c(n,"intlMessage")||l).call(o,{name:"intlMessage",hash:{intlName:"notifications.NOTIF_TURN_OFF_OBJECT"},data:a,loc:{start:{line:4,column:65},end:{line:4,column:127}}}))+'</li>\n\t\t<li class="notification-context-option turn-on-object-option hidden">'+s((c(e,"intlMessage")||n&&c(n,"intlMessage")||l).call(o,{name:"intlMessage",hash:{intlName:"notifications.NOTIF_TURN_ON_OBJECT"},data:a,loc:{start:{line:5,column:71},end:{line:5,column:132}}}))+"</li>\n\t</ul>\n\n</div>"},useData:!0}),i={};t.Array.each([],function(n){var e=t.Template.get("hermes/"+n);e&&(i[n]=e)}),t.Template.register("hermes/notification-context-menu",function(n,a){return a=a||{},a.partials=a.partials?t.merge(i,a.partials):i,e(n,a)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-notification-item-moderated",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,a,o){var l=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"\t\t\t"+e.escapeExpression((l(n,"intlHTMLMessage")||t&&l(t,"intlHTMLMessage")||e.hooks.helperMissing).call(null!=t?t:e.nullContext||{},{name:"intlHTMLMessage",hash:{learnUrl:"https://help.flickr.com/en_us/set-the-safety-levels-of-your-flickr-content-or-account-BJlsk6mjym",intlName:"notifications.NOTIF_PHOTO_MODERATED_RESTRICTED"},data:o,loc:{start:{line:4,column:3},end:{line:4,column:189}}}))+"\n"},3:function(e,t,n,a,o){var l=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"\t\t\t"+e.escapeExpression((l(n,"intlHTMLMessage")||t&&l(t,"intlHTMLMessage")||e.hooks.helperMissing).call(null!=t?t:e.nullContext||{},{name:"intlHTMLMessage",hash:{learnUrl:"https://help.flickr.com/en_us/set-the-safety-levels-of-your-flickr-content-or-account-BJlsk6mjym",intlName:"notifications.NOTIF_PHOTO_MODERATED_MODERATE"},data:o,loc:{start:{line:6,column:3},end:{line:6,column:187}}}))+"\n"},compiler:[8,">= 4.3.0"],main:function(e,t,n,a,o){var l,r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="details">\n\t<span class="headline">\n'+(null!=(l=r(n,"if").call(null!=t?t:e.nullContext||{},null!=t?r(t,"isRestricted"):t,{name:"if",hash:{},fn:e.program(1,o,0),inverse:e.program(3,o,0),data:o,loc:{start:{line:3,column:2},end:{line:7,column:9}}}))?l:"")+"\t</span>\n\n"+(null!=(l=e.invokePartial(r(a,"notification-photo-extra-info"),t,{name:"notification-photo-extra-info",data:o,indent:"\t",helpers:n,partials:a,decorators:e.decorators}))?l:"")+"</div>\n"},usePartial:!0,useData:!0}),a={};e.Array.each(["notification-photo-extra-info"],function(t){var n=e.Template.get("hermes/"+t);n&&(a[t]=n)}),e.Template.register("hermes/notification-item-moderated",function(t,o){return o=o||{},o.partials=o.partials?e.merge(a,o.partials):a,n(t,o)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-notification-photo-extra-info"]});YUI.add("hermes-template-notification",function(n,e){var t=n.Template.Handlebars.revive({1:function(n,e,t,a,l){return" has-menu"},3:function(n,e,t,a,l){return'\t\t<span class="notif-context-menu-caret"></span>\n'},compiler:[8,">= 4.3.0"],main:function(n,e,t,a,l){var r,o=null!=e?e:n.nullContext||{},i=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'<div class="notification'+(null!=(r=i(t,"if").call(o,null!=e?i(e,"hasMenu"):e,{name:"if",hash:{},fn:n.program(1,l,0),inverse:n.noop,data:l,loc:{start:{line:1,column:24},end:{line:1,column:55}}}))?r:"")+'">\n\t'+n.escapeExpression((i(t,"outlet")||e&&i(e,"outlet")||n.hooks.helperMissing).call(o,null!=e?i(e,"notifTemplate"):e,!1,{name:"outlet",hash:{},data:l,loc:{start:{line:2,column:1},end:{line:2,column:31}}}))+"\n\n"+(null!=(r=i(t,"if").call(o,null!=e?i(e,"hasMenu"):e,{name:"if",hash:{},fn:n.program(3,l,0),inverse:n.noop,data:l,loc:{start:{line:4,column:1},end:{line:6,column:8}}}))?r:"")+"</div>"},useData:!0}),a={};n.Array.each([],function(e){var t=n.Template.get("hermes/"+e);t&&(a[e]=t)}),n.Template.register("hermes/notification",function(e,l){return l=l||{},l.partials=l.partials?n.merge(a,l.partials):a,t(e,l)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("notification-view",function(t,e){var i=require("hermes-core/flog")(e);t.flutil;t.namespace("Views")[this.name]=t.Base.create("notification-view",t.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.notifId=t.id,this.object=t.object,this.objectType=t.objectType,this.subevents=t.events,this.isMuted=t.isMuted,this.notifModel=t.notifModel,this},loadState:function(){var e=this,i=[this.appContext.getModelRegistry("photo-group-invitations-models").then(function(t){e.invitationsModelRegistry=t})];return t.Promise.all(i)},buildContainer:function(){var t={params:{object:this.object,type:this.objectType,event:this.subevents[0],subCount:this.subevents.length-1,viewer:this.appContext.getViewer(),eventCount:this.subevents.length,events:this.subevents,hasMenu:!0},templateName:"",photoTemplateName:null};switch(t.params.type){case"photo":this.handlePhotoNotificationType(t);break;case"person":this.handlePersonNotificationType(t);break;case"group":this.handleGroupNotificationType(t);break;case"discussion":this.handleDiscussionNotificationType(t);break;case"gallery":this.handleGalleryNotificationType(t);break;case"flickrmail":this.handleFlickrMailNotificationType(t);break;case"testimonial":this.handleTestimonialNotificationType(t);break;default:return}return t.photoTemplateName&&(t.params.details=this.templates(t.photoTemplateName)(t.params),t.templateName="notification-photo-shell"),t.params.notifTemplate=this.templates(t.templateName)(t.params),this.setContainerWithTemplate("notification",t.params),this},handlePhotoNotificationType:function(t){for(var e=0;e<t.params.events.length;e++)t.params.events[e].owner.url="/photos/"+t.params.events[e].owner.pathAlias||t.params.events[e].owner.id;switch("group-invite"!==t.params.event.type&&(t.params.people=this.getEventOwners(t.params.events),t.params.peopleCount=t.params.people.length,t.params.subPeopleCount=t.params.people.length-1),t.params.event.type){case"comment":t.photoTemplateName="notification-photo-comment";break;case"fave":t.photoTemplateName="notification-photo-fave";break;case"gallery":t.templateName="notification-added-to-gallery";break;case"people":t.photoTemplateName="notification-person",t.params.object.owner.isMe||(t.params.hasMenu=!1);break;case"tag":t.photoTemplateName="notification-tag";break;case"photo_comment_mention":t.photoTemplateName="notification-mention";break;case"group_invite":t.params.groups=this.getEventGroups(t.params.events),t.params.groupsCount=t.params.groups.length,t.params.subGroupsCount=t.params.groups.length-1,t.templateName="notification-photo-group-invite";break;case"note":t.photoTemplateName="notification-photo-note";break;case"share":t.photoTemplateName="notification-photo-share",t.params.hasMenu=!1;break;case"photo_bot_moderated":t.photoTemplateName="notification-item-moderated",t.params.hasMenu=!1,t.params.isRestricted=2===t.params.event.toSafetyLevel,t.params.object.url+="?isModerated=true";break;default:return}},handlePersonNotificationType:function(t){if(t.params.event)switch(t.params.event.type){case"contacted":t.params.event.owner.url="/photos/"+t.params.event.owner.pathAlias||t.params.event.owner.id,t.templateName="notification-person-follow";break;case"friend_join":t.templateName="notification-friend-join";break;case"upload":t.templateName="notification-person-upload";break;default:return}t.params.hasMenu=!1},handleGroupNotificationType:function(t){t.params.event&&"group_user_invite"===t.params.event.type&&(t.templateName="notification-group-invite",t.params.hasMenu=!1)},handleDiscussionNotificationType:function(t){if(t.params.event)switch(t.params.event.type){case"group_topic_new":t.templateName="notification-group-topic-new",t.params.hasMenu=!1;break;case"topic_reply":case"reply_reply":t.params.people=this.getEventOwners(t.params.events),t.params.peopleCount=t.params.people.length,t.params.subPeopleCount=t.params.people.length-1,t.params.replyUrl=t.params.object.url+"/"+t.params.event.replyId,t.templateName="notification-group-discussion-reply";break;default:return}},handleGalleryNotificationType:function(t){t.params.event&&"comment"===t.params.event.type&&(t.params.people=this.getEventOwners(t.params.events),t.params.peopleCount=t.params.people.length,t.params.subPeopleCount=t.params.people.length-1,t.templateName="notification-gallery-comment")},handleFlickrMailNotificationType:function(t){t.params.event&&"flickrmail"===t.params.event.type&&(t.templateName="notification-flickrmail"),t.params.hasMenu=!1},handleTestimonialNotificationType:function(t){t.params.event&&"testimonial"===t.params.event.type&&(t.templateName="notification-testimonial"),t.params.hasMenu=!1},activate:function(){var t=this.subevents[0],e={type:this.objectType,id:this.object.id,eventType:t.type,latestTimestamp:t.timestamp,isMuted:this.isMuted},i=this.get("container");return this.notificationsList=i.ancestor(".notifications-list"),this.listItem=i.ancestor("li.notification-list-item"),this.ctxMenuArrow=i.one(".notif-context-menu-caret"),this.notification=this.listItem.one(".notification"),this.ctxMenuArrow&&this.registerEventHandler(this.ctxMenuArrow.on("click",this.handleContextArrowClick.bind(this))),this.ctxMenu||(i.appendChild(this.templates("notification-context-menu")({})),this.ctxMenu=i.one(".notification-context-menu")),this.turnOffOption=this.ctxMenu.one(".turn-off-object-option"),this.turnOnOption=this.ctxMenu.one(".turn-on-object-option"),this.turnOffOption&&this.registerEventHandler(this.turnOffOption.on("click",this.handleMuteObjectClick.bind(this,e,!0))),this.turnOnOption&&this.registerEventHandler(this.turnOnOption.on("click",this.handleMuteObjectClick.bind(this,e,!1))),e.isMuted?(this.turnOffOption.addClass("hidden"),this.turnOnOption.removeClass("hidden"),this.notification.addClass("muted")):(this.turnOnOption.addClass("hidden"),this.turnOffOption.removeClass("hidden")),"group_invite"===t.type&&(this.actionContainer=i.one(".action-container"),this.acceptButton=this.actionContainer.one(".button.accept"),this.declineButton=this.actionContainer.one(".button.decline"),this.registerEventHandler(this.acceptButton.on("click",this.handleGroupInviteAcceptClick.bind(this))),this.registerEventHandler(this.declineButton.on("click",this.handleGroupInviteDeclineClick.bind(this)))),this.registerEventHandler(i.on("click",this.handleAnalyticsClicks.bind(this))),this},getTaggedPeople:function(t){for(var e=[],i=0;i<t.length;i++){for(var n=t[i],o={id:n.personTagged.id,name:n.personTagged.displayname,url:n.personTagged.profileURL},a=!1,s=0;s<e.length;s++)if(e[s].id===o.id){a=!0;break}a||e.push(o)}return e},getEventOwners:function(t){for(var e=[],i=0;i<t.length;i++){for(var n=t[i],o={id:n.owner.id,name:n.owner.displayname,url:n.owner.profileURL},a=!1,s=0;s<e.length;s++)if(e[s].id===o.id){a=!0;break}a||e.push(o)}return e},getEventGroups:function(t){for(var e=[],i=0;i<t.length;i++){for(var n=t[i],o={id:n.group.id,title:n.group.title,url:n.group.url,iconUrl:n.group.bestIconURL},a=!1,s=0;s<e.length;s++)if(e[s].id===o.id){a=!0;break}a||e.push(o)}return e},handleContextArrowClick:function(t){this.toggleContextMenu()},toggleContextMenu:function(){this.listItem.hasClass("expanded")?this.listItem.removeClass("expanded"):(this.notificationsList.all(".notification-list-item.expanded").each(function(t){t.removeClass("expanded")}),this.listItem.addClass("expanded"),this.ctxMenu.removeClass("fast-close"))},handleMuteObjectClick:function(t,e,i){var n=this,o={};o.object_type=t.type,o.object_id=t.id,o.event_type=t.eventType,o.mute_after=t.latestTimestamp,e?(n.turnOffOption.addClass("disabled"),this.notifModel.remoteUpdateMutedObjects(o,this.appContext).then(function(t){n.turnOffOption.addClass("hidden"),n.turnOffOption.removeClass("disabled"),n.turnOnOption.removeClass("hidden"),n.notification.addClass("muted"),n.toggleContextMenu()},function(t){n.turnOffOption.removeClass("disabled")})):(n.turnOnOption.addClass("disabled"),this.notifModel.remoteUpdateUnmutedObjects(o,this.appContext).then(function(t){n.turnOnOption.addClass("hidden"),n.turnOnOption.removeClass("disabled"),n.turnOffOption.removeClass("hidden"),n.notification.removeClass("muted"),n.listItem.hasClass("expanded")&&n.toggleContextMenu()},function(t){n.turnOnOption.removeClass("disabled")})),n.ctxMenu.addClass("fast-close")},handleGroupInviteAcceptClick:function(t){var e=this;return this.actionContainer.addClass("loading"),this.invitationsModelRegistry.remote.acceptInvitation({groupID:e.subevents[0].group.id,userID:e.appContext.getViewer().nsid,photoID:e.object.id},e.appContext).then(function(t){return e.actionContainer.removeClass("loading"),e.actionContainer.addClass("accepted"),e.removeNotification(),t}).catch(function(t){throw i.error("Error accepting invite to group",{err:t}),e.actionContainer.removeClass("loading"),t})},handleGroupInviteDeclineClick:function(t){var e=this;return this.actionContainer.addClass("loading"),this.invitationsModelRegistry.remote.declineInvitation({groupID:e.subevents[0].group.id,userID:e.appContext.getViewer().nsid,photoID:e.object.id},e.appContext).then(function(t){return e.actionContainer.removeClass("loading"),e.actionContainer.addClass("declined"),e.removeNotification(),t}).catch(function(t){throw i.error("Error declining invite to group",{err:t}),e.actionContainer.removeClass("loading"),t})},removeNotification:function(){var t=this,e=this.notifModel.getValue("notifications").getList();e=e.filter(function(e){return t.notifModel.getValue("notifications").remove({id:e.id}),t.notifId!==e.id}),this.notifModel.getValue("notifications").concat(e)},handleAnalyticsClicks:function(e){var i=e.target,n=this.subevents[0].type;i.ancestor(".headline",!0)&&"A"===i.get("tagName").toUpperCase()?t.Analytics.sendClick("Notification Event Type: "+n,"Legacy Notification Headline Click"):i.ancestor(".photo-thumb",!0)?t.Analytics.sendClick("Notification Event Type: "+n,"Legacy Notification Photo Thumb Click"):i.ancestor(".avatar",!0)&&!i.ancestor(".photo-thumb",!0)?t.Analytics.sendClick("Notification Event Type: "+n,"Legacy Notification Avatar Click"):i.ancestor(".notif-context-menu-caret",!0)?t.Analytics.sendClick("Notification Event Type: "+n,"Legacy Notification Context Menu Click"):i.ancestor(".notification-context-option.turn-off-object-option",!0)?t.Analytics.sendClick("Notification Event Type: "+n,"Legacy Notification Mute Click"):i.ancestor(".notification-context-option.turn-on-object-option",!0)&&t.Analytics.sendClick("Notification Event Type: "+n,"Legacy Notification Unmute Click")}})},"@VERSION@",{requires:["flickr-view","flickr-promise","hermes-template-notifications","hermes-template-notification-photo-comment","hermes-template-notification-group-invite","hermes-template-notification-added-to-gallery","hermes-template-notification-photo-fave","hermes-template-notification-photo-shell","hermes-template-notification-person-follow","hermes-template-notification-person-upload","hermes-template-notification-tag","hermes-template-notification-person","hermes-template-notification-mention","hermes-template-notification-photo-group-invite","hermes-template-notification-photo-extra-info","hermes-template-notification-photo-note","hermes-template-notification-photo-share","hermes-template-notification-group-discussion-reply","hermes-template-notification-gallery-comment","hermes-template-notification-friend-join","hermes-template-notification-group-topic-new","hermes-template-notification-flickrmail","hermes-template-notification-testimonial","hermes-template-notification-context-menu","hermes-template-notification-item-moderated","hermes-template-notification"],langBundles:["common","relative-dates","notifications"]});