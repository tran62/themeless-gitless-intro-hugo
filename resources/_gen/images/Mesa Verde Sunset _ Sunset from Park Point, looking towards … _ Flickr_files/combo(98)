YUI.add("hermes-template-trustarc-consent",function(e,a){var r=e.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(e,a,r,t,n){return'<div class="basic-banner">\n\t<div class="blackbar-banner-container"></div>\n</div>'},useData:!0}),t={};e.Array.each([],function(a){var r=e.Template.get("hermes/"+a);r&&(t[a]=r)}),e.Template.register("hermes/trustarc-consent",function(a,n){return n=n||{},n.partials=n.partials?e.merge(t,n.partials):t,r(a,n)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("trustarc-consent-manager-view",function(t,e){var n=require("hermes-core/flog")(e);t.FlickrView.create(this.name,t.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this},loadState:function(){return this},buildContainer:function(){return this.setContainerWithTemplate("trustarc-consent"),this},activate:function(){var e=this.appContext.cookieConsentContext;return this.appContext.requiresCookieConsent?(t.Snowplough&&e.freshServerContext?(t.Snowplough.sendStructuredEvent({category:"cookie_consent",action:"consent_new"}),delete e.freshServerContext,this.appContext.cookieCatcher.setCookieIfAllowed(t.config.flickr.cookie_consent.consent_context_name,JSON.stringify(e),{path:"/",domain:t.config.flickr.cookies.domain,expires:this.expireTime})):n.error("Missing Y.Snowplough in trustarc-consent-manager-view.activate"),this.waitForTrustArc(),this.waitForBannerNode(),this):this},destructor:function(){clearTimeout(this.checkTrustModalTimeout)},checkManagerInteraction:function(e){var n;if(e&&e.data){try{n=JSON.parse(e.data)}catch(t){return}if(n&&(n.PrivacyManagerAPI||n.PrivacyManagerAPI)){var i={},o=t.config.win.PrivacyManagerAPI.callApi("getGDPRConsentDecision",t.config.win.location.host).consentDecision;o&&o.forEach(function(t){i[t]||(i[t]=1)}),o.length&&0!==o[0]&&this.appContext.cookieCatcher.handleConsentManagerChoice()}}},waitForTrustArc:function(){if("truste"in window&&"PrivacyManagerAPI"in window){clearTimeout(this.waitForTrustTimeout);var e=t.config.win.postMessage&&setInterval(function(){if(t.config.win.PrivacyManagerAPI&&e){var n={PrivacyManagerAPI:{action:"getConsentDecision",timestamp:(new Date).getTime(),self:t.config.win.location.host}};t.config.win.top.postMessage(JSON.stringify(n),"*"),e=clearInterval(e)}},50);t.config.win.addEventListener("message",this.checkManagerInteraction.bind(this)),this.registerEventHandler(t.one("body").all(".trustarc-cookie-pref-butt").on("click",function(){t.config.win.truste.eu.reopenBanner()}))}else this.waitForTrustTimeout=setTimeout(this.waitForTrustArc.bind(this),250)},waitForBannerNode:function(){var t=document.querySelector("#consent_blackbar"),e=this.get("container").one(".blackbar-banner-container");this.appContext.trustArcBannerClone&&e?(clearTimeout(this.waitForBannerTimeout),e.appendChild(this.appContext.trustArcBannerClone)):t&&e?(clearTimeout(this.waitForBannerTimeout),this.appContext.trustArcBannerClone=t,e.appendChild(t)):this.waitForBannerTimeout=setTimeout(this.waitForBannerNode.bind(this),100)}})},"@VERSION@",{requires:["promise","hermes-template-trustarc-consent"],langBundles:["common"]});